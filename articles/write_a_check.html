<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="sdtmchecks">
<title>Writing a New Check • sdtmchecks</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Writing a New Check">
<meta property="og:description" content="sdtmchecks">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-default navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">sdtmchecks</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.5</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/sdtmchecks.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/write_a_check.html">Writing a New Check</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/pharmaverse/sdtmchecks">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Writing a New Check</h1>
            
      
      
      <div class="d-none name"><code>write_a_check.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="background">Background<a class="anchor" aria-label="anchor" href="#background"></a>
</h2>
<p>Clinical trial datasets can contain a million different types of
incorrect data. This package does not intend to comprehensively cover
all scenarios in which data may be wrong. Instead the data checks in
this package are intended to be <strong>generalizable</strong>,
<strong>actionable</strong>, and <strong>meaningful for
analysis</strong>. For example many clinical trials contain the
<code>CO</code> domain, however the <code>sdtmchecks</code> package does
not have any functionality around this domain as it is usually not
meaningful for analysis.</p>
</div>
<div class="section level2">
<h2 id="working-in-github">Working in GitHub<a class="anchor" aria-label="anchor" href="#working-in-github"></a>
</h2>
<p>The <code>main</code> branch contains the latest released version and
should not be used for development.</p>
<p>The <code>devel</code> branch is the default branch and contains the
latest development version of the package. To start contributing, please
make a feature branch off of <code>devel</code>. When your code is ready
to be incorporated please open a pull request that another person will
review prior to merging the update into <code>devel</code>. If you do
not have write access to the repository, please work off of a forked
repo and <a href="https://docs.github.com/en/pull-requests/collaborating-with-pull-requests/proposing-changes-to-your-work-with-pull-requests/creating-a-pull-request-from-a-fork" class="external-link">open
a pull request from the fork</a>.</p>
</div>
<div class="section level2">
<h2 id="existing-checks">Existing Checks<a class="anchor" aria-label="anchor" href="#existing-checks"></a>
</h2>
<p>The <code>sdtmchecksmeta</code> dataset lists existing checks and
contains helpful additional information</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Just type this in</span></span>
<span><span class="va">sdtmchecksmeta</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 10 × 4</span></span></span>
<span><span class="co">##    check                              domains title                  description</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                              <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span> check_ae_aeacn_ds_disctx_covid     ae, ds  COVID AE trt discon    Check pati…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span> check_ae_aeacnoth                  ae      AE AEACNOTH multiple   Check for …</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span> check_ae_aeacnoth_ds_disctx        ae, ds  AE AEACNOTx Discon     Check for …</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span> check_ae_aeacnoth_ds_stddisc_covid ae, ds  COVID AE study discon  Check pati…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span> check_ae_aedecod                   ae      AE Missing PT          Check for …</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span> check_ae_aedthdtc_aesdth           ae      AE Death Date vs Indi… Check for …</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span> check_ae_aedthdtc_ds_death         ae, ds  DS Death Dates in AE   Check that…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span> check_ae_aelat                     ae      AE AELAT Missing       OPHTHALMOL…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span> check_ae_aeout                     ae      AE Death Outcome       Check for …</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span> check_ae_aeout_aeendtc_aedthdtc    ae      Fatal AE Resolution D… Check for …</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="good-practices">Good Practices<a class="anchor" aria-label="anchor" href="#good-practices"></a>
</h2>
<ul>
<li>
<p>When writing a new check, the function name should start with the
word ‘check’ and contain key dataset information plus a 1-2 word
description,
i.e. <code>check_[dataset1]_..._[datasetN]_[brief description]</code>.
For example:</p>
<ul>
<li><code>check_dm_race &lt;- function(DM){...}</code></li>
<li><code>check_dv_ae_covid &lt;- function(DV, AE){...}</code></li>
</ul>
</li>
<li><p>Each function should at minimum take the datasets being
investigated as parameters,
e.g. <code>check_ae_aedecod &lt;- function(AE){...}</code></p></li>
<li><p>Each function should start with a check for required variables.
The following internal functions may be helpful for this:
<code>%lacks_all%</code>,<code>%lacks_any%</code>,<code>%has_all%</code>,
or <code>%has_any%</code>.</p></li>
<li><p>All checks should use the internal <code><a href="../reference/pass.html">pass()</a></code> and
<code><a href="../reference/fail.html">fail()</a></code> functions to return either <code>TRUE</code> or
<code>FALSE</code> depending on check results. These functions enable
attributes to be attached to the boolean result, e.g. a message or a
listing of flagged records.</p></li>
<li><p><code>sdtmchecks</code> intentionally attempts to minimize
external dependencies. This is something to keep in mind when developing
a new check. Currently the only dependencies are <code>dplyr</code> and
<code>tidyselect</code>.</p></li>
</ul>
</div>
<div class="section level2">
<h2 id="example-check">Example Check<a class="anchor" aria-label="anchor" href="#example-check"></a>
</h2>
<p>If you are writing your first check it might be helpful to start by
editing an existing one, for example the one below:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Example check</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @param DM </span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @return boolean</span></span>
<span><span class="co">#' @export</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @examples</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' \dontrun{</span></span>
<span><span class="co">#'    check_dm_age_missing(DM)</span></span>
<span><span class="co">#'   }</span></span>
<span><span class="co">#'</span></span>
<span></span>
<span><span class="va">check_dm_age_missing</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">DM</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="co">###First check that required variables exist and return a message if they don't</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="va">DM</span> <span class="op"><a href="../reference/grapes-lacks_any-grapes.html">%lacks_any%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"USUBJID"</span>,<span class="st">"AGE"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>      <span class="fu"><a href="../reference/fail.html">fail</a></span><span class="op">(</span><span class="fu"><a href="../reference/lacks_msg.html">lacks_msg</a></span><span class="op">(</span><span class="va">DM</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"USUBJID"</span>,<span class="st">"AGE"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="kw">else</span><span class="op">{</span></span>
<span>    <span class="co">### Subset DM to only records with missing AGE</span></span>
<span>    <span class="va">mydf_0</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">DM</span>, <span class="fu"><a href="../reference/is_sas_na.html">is_sas_na</a></span><span class="op">(</span><span class="va">DM</span><span class="op">$</span><span class="va">AGE</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"USUBJID"</span>,<span class="st">"AGE"</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="co">### Subset DM to only records with AGE&lt;18</span></span>
<span>    <span class="va">mydf_1</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">DM</span>, <span class="op">!</span><span class="fu"><a href="../reference/is_sas_na.html">is_sas_na</a></span><span class="op">(</span><span class="va">DM</span><span class="op">$</span><span class="va">AGE</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">DM</span><span class="op">$</span><span class="va">AGE</span><span class="op">&lt;</span><span class="fl">18</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"USUBJID"</span>,<span class="st">"AGE"</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="co">### Subset DM to only records with AGE&gt;90</span></span>
<span>    <span class="va">mydf_2</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">DM</span>, <span class="op">!</span><span class="fu"><a href="../reference/is_sas_na.html">is_sas_na</a></span><span class="op">(</span><span class="va">DM</span><span class="op">$</span><span class="va">AGE</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">DM</span><span class="op">$</span><span class="va">AGE</span><span class="op">&gt;=</span><span class="fl">90</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"USUBJID"</span>,<span class="st">"AGE"</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="co">### Combine records with abnormal AGE</span></span>
<span>    <span class="va">mydf3</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">mydf_0</span>, <span class="va">mydf_1</span>, <span class="va">mydf_2</span><span class="op">)</span></span>
<span>    <span class="va">mydf</span> <span class="op">=</span> <span class="va">mydf3</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">mydf3</span><span class="op">$</span><span class="va">USUBJID</span><span class="op">)</span>,<span class="op">]</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">mydf</span><span class="op">)</span><span class="op">=</span><span class="cn">NULL</span></span>
<span>    <span class="co">###Print to report</span></span>
<span>    <span class="co">### Return message if no records with missing AGE, AGE&lt;18 or AGE&gt;90</span></span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">mydf</span><span class="op">)</span><span class="op">==</span><span class="fl">0</span><span class="op">)</span><span class="op">{</span></span>
<span>      <span class="fu"><a href="../reference/pass.html">pass</a></span><span class="op">(</span><span class="op">)</span></span>
<span>      <span class="co">### Return subset dataframe if there are records with missing AGE, AGE&lt;18 or AGE&gt;90</span></span>
<span>    <span class="op">}</span><span class="kw">else</span> <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">mydf</span><span class="op">)</span><span class="op">&gt;</span><span class="fl">0</span><span class="op">)</span><span class="op">{</span></span>
<span>        <span class="fu"><a href="../reference/fail.html">fail</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"There are "</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">mydf</span><span class="op">$</span><span class="va">USUBJID</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                   <span class="st">" patients with suspicious age values. "</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span>,</span>
<span>             <span class="va">mydf</span><span class="op">)</span></span>
<span>        <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="additional-considerations">Additional Considerations<a class="anchor" aria-label="anchor" href="#additional-considerations"></a>
</h2>
<ul>
<li>Is this check impactful for analysis? Checking little used aspects
of SDTM data can cause unnecessary work.</li>
<li>Will this check be meaningful across many trials or is specific to
just a small number of trials?</li>
<li>Are false positives being minimized? The check will not be useful if
end users need to sift through a large number of incorrectly flagged
records to find a one or two correctly flagged records.</li>
<li>Do SDTM IG or MedDRA versions need to be considered?</li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Will Harris.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
